{"remainingRequest":"F:\\个人git项目\\couldr-user\\node_modules\\babel-loader\\lib\\index.js!F:\\个人git项目\\couldr-user\\node_modules\\eslint-loader\\index.js??ref--13-0!F:\\个人git项目\\couldr-user\\src\\utils\\request.js","dependencies":[{"path":"F:\\个人git项目\\couldr-user\\src\\utils\\request.js","mtime":1584950108893},{"path":"F:\\个人git项目\\couldr-user\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\个人git项目\\couldr-user\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"F:\\个人git项目\\couldr-user\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCBWdWUgZnJvbSAndnVlJzsKaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJzsKaW1wb3J0IHN0b3JlIGZyb20gJ0Avc3RvcmUnOwppbXBvcnQgbm90aWZpY2F0aW9uIGZyb20gJ2FudC1kZXNpZ24tdnVlL2VzL25vdGlmaWNhdGlvbic7CmltcG9ydCB7IFZ1ZUF4aW9zIH0gZnJvbSAnLi9heGlvcyc7CmltcG9ydCB7IEFDQ0VTU19UT0tFTiB9IGZyb20gJ0Avc3RvcmUvbXV0YXRpb24tdHlwZXMnOyAvLyDliJvlu7ogYXhpb3Mg5a6e5L6LCgp2YXIgc2VydmljZSA9IGF4aW9zLmNyZWF0ZSh7CiAgYmFzZVVSTDogcHJvY2Vzcy5lbnYuVlVFX0FQUF9BUElfQkFTRV9VUkwsCiAgLy8gYXBpIGJhc2VfdXJsCiAgdGltZW91dDogNjAwMCwKICAvLyDor7fmsYLotoXml7bml7bpl7QKICB3aXRoQ3JlZGVudGlhbHM6IHRydWUKfSk7Ci8qIGZ1bmN0aW9uIHNldFRva2VuVG9IZWFkZXIoY29uZmlnKSB7DQogIC8vIHNldCB0b2tlbg0KICBjb25zdCB0b2tlbiA9IHN0b3JlLmdldHRlcnMudG9rZW4NCgljb25zb2xlLmxvZyh0b2tlbikNCiAgVnVlLiRsb2cuZGVidWcoJ0dvdCB0b2tlbiBmcm9tIHN0b3JlJywgdG9rZW4pDQogIGlmICh0b2tlbiAmJiB0b2tlbi5hY2Nlc3NfdG9rZW4pIHsNCiAgICBjb25maWcuaGVhZGVyc1snQWRtaW4tQXV0aG9yaXphdGlvbiddID0gdG9rZW4uYWNjZXNzX3Rva2VuDQogIH0NCn0gKi8KCnZhciBlcnIgPSBmdW5jdGlvbiBlcnIoZXJyb3IpIHsKICBpZiAoZXJyb3IucmVzcG9uc2UpIHsKICAgIHZhciBkYXRhID0gZXJyb3IucmVzcG9uc2UuZGF0YTsKICAgIHZhciB0b2tlbiA9IFZ1ZS5scy5nZXQoQUNDRVNTX1RPS0VOKTsKCiAgICBpZiAoZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA0MDApIHsKICAgICAgbm90aWZpY2F0aW9uLmVycm9yKHsKICAgICAgICBtZXNzYWdlOiAnRm9yYmlkZGVuJywKICAgICAgICBkZXNjcmlwdGlvbjogZGF0YS5tZXNzYWdlCiAgICAgIH0pOwogICAgfQoKICAgIGlmIChlcnJvci5yZXNwb25zZS5zdGF0dXMgPT09IDQwMykgewogICAgICBub3RpZmljYXRpb24uZXJyb3IoewogICAgICAgIG1lc3NhZ2U6ICdGb3JiaWRkZW4nLAogICAgICAgIGRlc2NyaXB0aW9uOiBkYXRhLm1lc3NhZ2UKICAgICAgfSk7CiAgICB9CgogICAgaWYgKGVycm9yLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxICYmICEoZGF0YS5yZXN1bHQgJiYgZGF0YS5yZXN1bHQuaXNMb2dpbikpIHsKICAgICAgbm90aWZpY2F0aW9uLmVycm9yKHsKICAgICAgICBtZXNzYWdlOiAnVW5hdXRob3JpemVkJywKICAgICAgICBkZXNjcmlwdGlvbjogJ0F1dGhvcml6YXRpb24gdmVyaWZpY2F0aW9uIGZhaWxlZCcKICAgICAgfSk7CgogICAgICBpZiAodG9rZW4pIHsKICAgICAgICBzdG9yZS5kaXNwYXRjaCgnTG9nb3V0JykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwogICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9CgogIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7Cn07IC8vIHJlcXVlc3QgaW50ZXJjZXB0b3IKCgpzZXJ2aWNlLmludGVyY2VwdG9ycy5yZXF1ZXN0LnVzZShmdW5jdGlvbiAoY29uZmlnKSB7CiAgdmFyIHRva2VuID0gVnVlLmxzLmdldChBQ0NFU1NfVE9LRU4pOwoKICBpZiAodG9rZW4pIHsKICAgIC8vIGNvbmZpZy5oZWFkZXJzWydBY2Nlc3MtVG9rZW4nXSA9IHRva2VuIC8vIOiuqeavj+S4quivt+axguaQuuW4puiHquWumuS5iSB0b2tlbiDor7fmoLnmja7lrp7pmYXmg4XlhrXoh6rooYzkv67mlLkKICAgIGNvbmZpZy5oZWFkZXJzWydBZG1pbi1BdXRob3JpemF0aW9uJ10gPSB0b2tlbjsKICB9CgogIHJldHVybiBjb25maWc7Cn0sIGVycik7IC8vIHJlc3BvbnNlIGludGVyY2VwdG9yCgpzZXJ2aWNlLmludGVyY2VwdG9ycy5yZXNwb25zZS51c2UoZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7Cn0sIGVycik7CnZhciBpbnN0YWxsZXIgPSB7CiAgdm06IHt9LAogIGluc3RhbGw6IGZ1bmN0aW9uIGluc3RhbGwoVnVlKSB7CiAgICBWdWUudXNlKFZ1ZUF4aW9zLCBzZXJ2aWNlKTsKICB9Cn07CmV4cG9ydCB7IGluc3RhbGxlciBhcyBWdWVBeGlvcywgc2VydmljZSBhcyBheGlvcyB9Ow=="},{"version":3,"sources":["F:/个人git项目/couldr-user/src/utils/request.js"],"names":["Vue","axios","store","notification","VueAxios","ACCESS_TOKEN","service","create","baseURL","process","env","VUE_APP_API_BASE_URL","timeout","withCredentials","err","error","response","data","token","ls","get","status","message","description","result","isLogin","dispatch","then","setTimeout","window","location","reload","Promise","reject","interceptors","request","use","config","headers","installer","vm","install"],"mappings":"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","sourcesContent":["import Vue from 'vue'\r\nimport axios from 'axios'\r\nimport store from '@/store'\r\nimport notification from 'ant-design-vue/es/notification'\r\nimport { VueAxios } from './axios'\r\nimport { ACCESS_TOKEN } from '@/store/mutation-types'\r\n\r\n// 创建 axios 实例\r\nconst service = axios.create({\r\n  baseURL: process.env.VUE_APP_API_BASE_URL, // api base_url\r\n  timeout: 6000, // 请求超时时间\r\n\twithCredentials: true\r\n})\r\n\r\n/* function setTokenToHeader(config) {\r\n  // set token\r\n  const token = store.getters.token\r\n\tconsole.log(token)\r\n  Vue.$log.debug('Got token from store', token)\r\n  if (token && token.access_token) {\r\n    config.headers['Admin-Authorization'] = token.access_token\r\n  }\r\n} */\r\n\r\nconst err = (error) => {\r\n  if (error.response) {\r\n    const data = error.response.data\r\n    const token = Vue.ls.get(ACCESS_TOKEN)\r\n\t\tif (error.response.status === 400) {\r\n\t\t  notification.error({\r\n\t\t    message: 'Forbidden',\r\n\t\t    description: data.message\r\n\t\t  })\r\n\t\t}\r\n    if (error.response.status === 403) {\r\n      notification.error({\r\n        message: 'Forbidden',\r\n        description: data.message\r\n      })\r\n    }\r\n    if (error.response.status === 401 && !(data.result && data.result.isLogin)) {\r\n      notification.error({\r\n        message: 'Unauthorized',\r\n        description: 'Authorization verification failed'\r\n      })\r\n      if (token) {\r\n        store.dispatch('Logout').then(() => {\r\n          setTimeout(() => {\r\n            window.location.reload()\r\n          }, 1500)\r\n        })\r\n      }\r\n    }\r\n  }\r\n  return Promise.reject(error)\r\n}\r\n\r\n// request interceptor\r\nservice.interceptors.request.use(config => {\r\n  const token = Vue.ls.get(ACCESS_TOKEN)\r\n  if (token) {\r\n   // config.headers['Access-Token'] = token // 让每个请求携带自定义 token 请根据实际情况自行修改\r\n\t\tconfig.headers['Admin-Authorization'] = token\r\n  }\r\n  return config\r\n}, err)\r\n\r\n// response interceptor\r\nservice.interceptors.response.use((response) => {\r\n  return response.data\r\n}, err)\r\n\r\nconst installer = {\r\n  vm: {},\r\n  install (Vue) {\r\n    Vue.use(VueAxios, service)\r\n  }\r\n}\r\n\r\nexport {\r\n  installer as VueAxios,\r\n  service as axios\r\n}\r\n"]}]}