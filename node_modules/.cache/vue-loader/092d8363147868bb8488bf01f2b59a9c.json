{"remainingRequest":"F:\\个人git项目\\couldr-user\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\个人git项目\\couldr-user\\src\\views\\file\\AttachmentPreview.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\个人git项目\\couldr-user\\src\\views\\file\\AttachmentPreview.vue","mtime":1585148902014},{"path":"F:\\个人git项目\\couldr-user\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\个人git项目\\couldr-user\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"F:\\个人git项目\\couldr-user\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\个人git项目\\couldr-user\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgJ3Z1ZS1kcGxheWVyL2Rpc3QvdnVlLWRwbGF5ZXIuY3NzJw0KaW1wb3J0IFZ1ZURQbGF5ZXIgZnJvbSAndnVlLWRwbGF5ZXInDQoNCmV4cG9ydCBkZWZhdWx0IHsNCgluYW1lOiAnQXR0YWNobWVudFByZXZpZXcnLA0KCWNvbXBvbmVudHM6IHsNCgkJJ2QtcGxheWVyJzogVnVlRFBsYXllcg0KCX0sDQoJcHJvcHM6IHsNCgkgIGF0dGFjaG1lbnQ6IHsNCgkgICAgdHlwZTogT2JqZWN0LA0KCSAgICByZXF1aXJlZDogdHJ1ZQ0KCSAgfSwNCgkJdmlzaWJsZTogew0KCQkgIHR5cGU6IEJvb2xlYW4sDQoJCSAgcmVxdWlyZWQ6IGZhbHNlLA0KCQkgIGRlZmF1bHQ6IHRydWUNCgkJfQ0KCX0sDQoJZGF0YSAoKSB7DQoJCXJldHVybiB7DQoJCQlwaG90bzoge30sDQoJCQlwcmV2aWV3TG9hZGluZzogdHJ1ZSwNCgkJCXBob3RvUHJldmlld1Zpc2libGU6IGZhbHNlLA0KCQkJdmlkZW9QcmV2aWV3VmlzaWJsZTogZmFsc2UsDQoJCQlub25zdXBwb3J0UHJldmlld1Zpc2libGU6IGZhbHNlLA0KCQkJcGxheWVyOiB7fSwNCgkJCXZpZGVvT3B0aW9uczogew0KCQkJICBsYW5nOiAnemgtY24nLA0KCQkJICB2aWRlbzogew0KCQkJICAgIHVybDogJycsDQoJCQkgICAgdHlwZTogJ2F1dG8nDQoJCQkgIH0NCgkJCX0NCgkJfQ0KCX0sDQoJd2F0Y2g6IHsNCgkJdmlzaWJsZTogZnVuY3Rpb24obmV3VmFsdWUsIG9sZFZhbHVlKSB7DQoJCSAgLyogdGhpcy4kbG9nLmRlYnVnKCdvbGQgdmFsdWUnLCBvbGRWYWx1ZSkNCgkJICB0aGlzLiRsb2cuZGVidWcoJ25ldyB2YWx1ZScsIG5ld1ZhbHVlKSAqLw0KCQkgIGlmIChuZXdWYWx1ZSkgew0KCQkgICAgdGhpcy5sb2FkU2tlbGV0b24oKQ0KCQkgIH0NCgkJfSwNCgkgIGF0dGFjaG1lbnQ6IGZ1bmN0aW9uKG5ld1ZhbHVlLCBvbGRWYWx1ZSkgew0KCSAgICBpZiAobmV3VmFsdWUpIHsNCgkgICAgICB2YXIgYXR0YWNobWVudCA9IG5ld1ZhbHVlDQoJICAgICAgdGhpcy5oYW5kbGVKdWRnZU1lZGlhVHlwZShhdHRhY2htZW50KQ0KCSAgICB9DQoJICB9DQoJfSwNCgltZXRob2RzOiB7DQoJCWxvYWRTa2VsZXRvbigpIHsNCgkJICB0aGlzLnByZXZpZXdMb2FkaW5nID0gdHJ1ZQ0KCQkgIHNldFRpbWVvdXQoKCkgPT4gew0KCQkgICAgdGhpcy5wcmV2aWV3TG9hZGluZyA9IGZhbHNlDQoJCSAgfSwgNTAwKQ0KCQl9LA0KCQloYW5kbGVKdWRnZU1lZGlhVHlwZShhdHRhY2htZW50KSB7DQoJCSAgdmFyIG1lZGlhVHlwZSA9IGF0dGFjaG1lbnQubWVkaWFUeXBlDQoJCSAgLy8g5Yik5pat5paH5Lu257G75Z6LDQoJCSAgaWYgKG1lZGlhVHlwZSkgew0KCQkgICAgdmFyIHByZWZpeCA9IG1lZGlhVHlwZS5zcGxpdCgnLycpWzBdDQoJCSAgICBpZiAocHJlZml4ID09PSAndmlkZW8nIHx8IHByZWZpeCA9PT0gJ2ZsdicpIHsNCgkJICAgICAgLy8g5o6n5Yi25ZCE5Liq57uE5Lu255qE5pi+56S6DQoJCSAgICAgIHRoaXMuaGFuZGxlUHJldmlld1Zpc2libGUoZmFsc2UsIHRydWUsIGZhbHNlKQ0KCQkNCgkJICAgICAgLy8g5Y676Zmk6KeG6aKR5Zyw5Z2A5ZCO6Z2i55qE5Y+C5pWwDQoJCSAgICAgIHZhciBsYXN0SW5kZXggPSBhdHRhY2htZW50LnBhdGgubGFzdEluZGV4T2YoJz8nKQ0KCQkgICAgICB2YXIgcGF0aCA9IGF0dGFjaG1lbnQucGF0aC5zdWJzdHJpbmcoMCwgbGFzdEluZGV4ID09PSAtMSA/IGF0dGFjaG1lbnQucGF0aC5sZW5naHQgOiBsYXN0SW5kZXgpDQoJCSAgICAgIC8vIOiuvue9ruinhumikeWcsOWdgA0KCQkgICAgICB0aGlzLiRzZXQodGhpcy52aWRlb09wdGlvbnMudmlkZW8sICd1cmwnLCBwYXRoKQ0KCQkgICAgICAvKiB0aGlzLiRsb2cuZGVidWcoJ3ZpZGVvIHVybCcsIHBhdGgpICovDQoJCQkJCWNvbnNvbGUubG9nKCd2aWRlbyB1cmw6JyArIHBhdGgpDQoJCSAgICB9IGVsc2UgaWYgKHByZWZpeCA9PT0gJ2ltYWdlJykgew0KCQkgICAgICB0aGlzLmhhbmRsZVByZXZpZXdWaXNpYmxlKHRydWUsIGZhbHNlLCBmYWxzZSkNCgkJICAgIH0gZWxzZSB7DQoJCSAgICAgIHRoaXMuaGFuZGxlUHJldmlld1Zpc2libGUoZmFsc2UsIGZhbHNlLCB0cnVlKQ0KCQkgICAgfQ0KCQkgIH0NCgkJfSwNCgkJaGFuZGxlUHJldmlld1Zpc2libGUocGhvdG8sIHZpZGVvLCBub25zdXBwb3J0KSB7DQoJCQljb25zb2xlLmxvZygndmlkZW8nKQ0KCQkgIC8vIOS4uuS6huabtOWlveeahOS9v3Z1ZeebkeWQrOWIsOe7hOS7tuWPmOWMluWPiuaXtuWIt+aWsCzmlrnlvI/kv67mlLnnu4Tku7blkI7pnIDopoHliLfmlrDmiY3og73mmL7npLrkuIDkuIvpg6jliIYNCgkJICB0aGlzLiRzZXQodGhpcywgJ3Bob3RvUHJldmlld1Zpc2libGUnLCBwaG90bykNCgkJICB0aGlzLiRzZXQodGhpcywgJ3ZpZGVvUHJldmlld1Zpc2libGUnLCB2aWRlbykNCgkJICB0aGlzLiRzZXQodGhpcywgJ25vbnN1cHBvcnRQcmV2aWV3VmlzaWJsZScsIG5vbnN1cHBvcnQpDQoJCX0NCgl9DQp9Cg=="},{"version":3,"sources":["AttachmentPreview.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAqBA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"AttachmentPreview.vue","sourceRoot":"src/views/file","sourcesContent":["<template>\r\n\t\t<a-modal\r\n\t\t  title=\"HTML5播放器\"\r\n\t\t  v-model=\"videoPreviewVisible\"\r\n\t\t\t:footer=\"null\"\r\n\t\t\t:maskClosable=\"false\"\r\n\t\t\t:maskStyle=\"{'background-color':'rgba(0, 0, 0, 0)'}\"\r\n\t\t\twrapClassName=\"dplayer-modal\"\r\n\t\t>\r\n\t\t  <d-player\r\n\t\t    ref=\"player\"\r\n\t\t    :options=\"videoOptions\"\r\n\t\t    v-show=\"videoPreviewVisible\"\r\n\t\t    class=\"video-player-box\"\r\n\t\t    style=\"width: 100%;\"\r\n\t\t  >\r\n\t\t  </d-player>\r\n\t\t</a-modal>\r\n</template>\n\n<script>\r\nimport 'vue-dplayer/dist/vue-dplayer.css'\r\nimport VueDPlayer from 'vue-dplayer'\r\n\r\nexport default {\r\n\tname: 'AttachmentPreview',\r\n\tcomponents: {\r\n\t\t'd-player': VueDPlayer\r\n\t},\r\n\tprops: {\r\n\t  attachment: {\r\n\t    type: Object,\r\n\t    required: true\r\n\t  },\r\n\t\tvisible: {\r\n\t\t  type: Boolean,\r\n\t\t  required: false,\r\n\t\t  default: true\r\n\t\t}\r\n\t},\r\n\tdata () {\r\n\t\treturn {\r\n\t\t\tphoto: {},\r\n\t\t\tpreviewLoading: true,\r\n\t\t\tphotoPreviewVisible: false,\r\n\t\t\tvideoPreviewVisible: false,\r\n\t\t\tnonsupportPreviewVisible: false,\r\n\t\t\tplayer: {},\r\n\t\t\tvideoOptions: {\r\n\t\t\t  lang: 'zh-cn',\r\n\t\t\t  video: {\r\n\t\t\t    url: '',\r\n\t\t\t    type: 'auto'\r\n\t\t\t  }\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\twatch: {\r\n\t\tvisible: function(newValue, oldValue) {\r\n\t\t  /* this.$log.debug('old value', oldValue)\r\n\t\t  this.$log.debug('new value', newValue) */\r\n\t\t  if (newValue) {\r\n\t\t    this.loadSkeleton()\r\n\t\t  }\r\n\t\t},\r\n\t  attachment: function(newValue, oldValue) {\r\n\t    if (newValue) {\r\n\t      var attachment = newValue\r\n\t      this.handleJudgeMediaType(attachment)\r\n\t    }\r\n\t  }\r\n\t},\r\n\tmethods: {\r\n\t\tloadSkeleton() {\r\n\t\t  this.previewLoading = true\r\n\t\t  setTimeout(() => {\r\n\t\t    this.previewLoading = false\r\n\t\t  }, 500)\r\n\t\t},\r\n\t\thandleJudgeMediaType(attachment) {\r\n\t\t  var mediaType = attachment.mediaType\r\n\t\t  // 判断文件类型\r\n\t\t  if (mediaType) {\r\n\t\t    var prefix = mediaType.split('/')[0]\r\n\t\t    if (prefix === 'video' || prefix === 'flv') {\r\n\t\t      // 控制各个组件的显示\r\n\t\t      this.handlePreviewVisible(false, true, false)\r\n\t\t\r\n\t\t      // 去除视频地址后面的参数\r\n\t\t      var lastIndex = attachment.path.lastIndexOf('?')\r\n\t\t      var path = attachment.path.substring(0, lastIndex === -1 ? attachment.path.lenght : lastIndex)\r\n\t\t      // 设置视频地址\r\n\t\t      this.$set(this.videoOptions.video, 'url', path)\r\n\t\t      /* this.$log.debug('video url', path) */\r\n\t\t\t\t\tconsole.log('video url:' + path)\r\n\t\t    } else if (prefix === 'image') {\r\n\t\t      this.handlePreviewVisible(true, false, false)\r\n\t\t    } else {\r\n\t\t      this.handlePreviewVisible(false, false, true)\r\n\t\t    }\r\n\t\t  }\r\n\t\t},\r\n\t\thandlePreviewVisible(photo, video, nonsupport) {\r\n\t\t\tconsole.log('video')\r\n\t\t  // 为了更好的使vue监听到组件变化及时刷新,方式修改组件后需要刷新才能显示一下部分\r\n\t\t  this.$set(this, 'photoPreviewVisible', photo)\r\n\t\t  this.$set(this, 'videoPreviewVisible', video)\r\n\t\t  this.$set(this, 'nonsupportPreviewVisible', nonsupport)\r\n\t\t}\r\n\t}\r\n}\n</script>\n\n<style>\r\n\t.dplayer-modal  .ant-modal-title {\r\n\t\tline-height: 4px;\r\n\t}\r\n\t\t\t\r\n\t.dplayer-modal\t.ant-modal-close-x {\r\n\t\tline-height: 32px;\r\n\t}\r\n\t\n</style>\n"]}]}