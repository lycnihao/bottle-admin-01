{"remainingRequest":"D:\\iksen\\个人git项目\\squirrel-admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\iksen\\个人git项目\\squirrel-admin\\src\\views\\file\\AttachmentPreview.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\iksen\\个人git项目\\squirrel-admin\\src\\views\\file\\AttachmentPreview.vue","mtime":1586223528394},{"path":"D:\\iksen\\个人git项目\\squirrel-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1586223459088},{"path":"D:\\iksen\\个人git项目\\squirrel-admin\\node_modules\\babel-loader\\lib\\index.js","mtime":1586223449822},{"path":"D:\\iksen\\个人git项目\\squirrel-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1586223459088},{"path":"D:\\iksen\\个人git项目\\squirrel-admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1586223523515}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgJ3Z1ZS1kcGxheWVyL2Rpc3QvdnVlLWRwbGF5ZXIuY3NzJw0KaW1wb3J0IFZ1ZURQbGF5ZXIgZnJvbSAndnVlLWRwbGF5ZXInDQppbXBvcnQgJ3ZpZXdlcmpzL2Rpc3Qvdmlld2VyLmNzcycNCmltcG9ydCBWaWV3ZXIgZnJvbSAndmlld2VyanMnDQoNCg0KZXhwb3J0IGRlZmF1bHQgew0KCW5hbWU6ICdBdHRhY2htZW50UHJldmlldycsDQoJY29tcG9uZW50czogew0KCQknZC1wbGF5ZXInOiBWdWVEUGxheWVyDQoJfSwNCglwcm9wczogew0KCSAgYXR0YWNobWVudDogew0KCSAgICB0eXBlOiBPYmplY3QsDQoJICAgIHJlcXVpcmVkOiB0cnVlDQoJICB9LA0KCQl2aXNpYmxlOiB7DQoJCSAgdHlwZTogQm9vbGVhbiwNCgkJICByZXF1aXJlZDogZmFsc2UsDQoJCSAgZGVmYXVsdDogdHJ1ZQ0KCQl9DQoJfSwNCglkYXRhICgpIHsNCgkJcmV0dXJuIHsNCgkJCXBob3RvOiB7fSwNCgkJCXByZXZpZXdMb2FkaW5nOiB0cnVlLA0KCQkJcGhvdG9QcmV2aWV3VmlzaWJsZTogZmFsc2UsDQoJCQl2aWRlb1ByZXZpZXdWaXNpYmxlOiBmYWxzZSwNCgkJCW5vbnN1cHBvcnRQcmV2aWV3VmlzaWJsZTogZmFsc2UsDQoJCQlwbGF5ZXI6IHt9LA0KCQkJdmlkZW9PcHRpb25zOiB7DQoJCQkgIGxhbmc6ICd6aC1jbicsDQoJCQkgIHZpZGVvOiB7DQoJCQkgICAgdXJsOiAnJywNCgkJCSAgICB0eXBlOiAnYXV0bycNCgkJCSAgfQ0KCQkJfQ0KCQl9DQoJfSwNCgl3YXRjaDogew0KCQl2aXNpYmxlOiBmdW5jdGlvbihuZXdWYWx1ZSwgb2xkVmFsdWUpIHsNCgkJICAvKiB0aGlzLiRsb2cuZGVidWcoJ29sZCB2YWx1ZScsIG9sZFZhbHVlKQ0KCQkgIHRoaXMuJGxvZy5kZWJ1ZygnbmV3IHZhbHVlJywgbmV3VmFsdWUpICovDQoJCSAgaWYgKG5ld1ZhbHVlKSB7DQoJCSAgICB0aGlzLmxvYWRTa2VsZXRvbigpDQoJCSAgfQ0KCQl9LA0KCSAgYXR0YWNobWVudDogZnVuY3Rpb24obmV3VmFsdWUsIG9sZFZhbHVlKSB7DQoJICAgIGlmIChuZXdWYWx1ZSkgew0KCSAgICAgIHZhciBhdHRhY2htZW50ID0gbmV3VmFsdWUNCgkgICAgICB0aGlzLmhhbmRsZUp1ZGdlTWVkaWFUeXBlKGF0dGFjaG1lbnQpDQoJICAgIH0NCgkgIH0sDQoJCXBob3RvUHJldmlld1Zpc2libGU6IGZ1bmN0aW9uKG5ld1ZhbHVlLCBvbGRWYWx1ZSkgew0KCQkJdGhpcy5zaG93Vmlld2VyKHRoaXMsIHRoaXMucGhvdG9QcmV2aWV3VmlzaWJsZSkNCgkJfQ0KCX0sDQoJbWV0aG9kczogew0KCQlzaG93Vmlld2VyKHRoYXQsIHBob3RvUHJldmlld1Zpc2libGUpIHsNCgkJCWlmIChwaG90b1ByZXZpZXdWaXNpYmxlKSB7DQoJCQkJdmFyIGltYWdlID0gbmV3IEltYWdlKCkNCgkJCQlpbWFnZS5zcmMgPSB0aGlzLmF0dGFjaG1lbnQucGF0aA0KCQkJCXZhciB2aWV3ZXIgPSBuZXcgVmlld2VyKGltYWdlLCB7DQoJCQkJCWhpZGRlbigpIHsNCgkJCQkJCXZpZXdlci5kZXN0cm95KCkNCgkJCQkJCXRoYXQucGhvdG9QcmV2aWV3VmlzaWJsZSA9ICFwaG90b1ByZXZpZXdWaXNpYmxlDQoJCQkJCX0NCgkJCQl9KQ0KCQkJCXZpZXdlci5zaG93KCkNCgkJCX0NCgkJfSwNCgkJbW92ZShlKSB7DQoJCQkgLy8g6I635Y+W55uu5qCH5YWD57SgDQoJCQljb25zdCBvZGl2ID0gZS50YXJnZXQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50DQoJCQkvLyDnrpflh7rpvKDmoIfnm7jlr7nlhYPntKDnmoTkvY3nva4NCgkJCWNvbnN0IGRpc1ggPSBlLmNsaWVudFggLSBvZGl2Lm9mZnNldExlZnQNCgkJCWNvbnN0IGRpc1kgPSBlLmNsaWVudFkgLSBvZGl2Lm9mZnNldFRvcA0KCQkJLy8g6byg5qCH5oyJ5LiL5bm256e75Yqo55qE5LqL5Lu2DQoJCQlkb2N1bWVudC5vbm1vdXNlbW92ZSA9IChlKSA9PiB7ICAgICAgIA0KCQkJCQkvLyDnlKjpvKDmoIfnmoTkvY3nva7lh4/ljrvpvKDmoIfnm7jlr7nlhYPntKDnmoTkvY3nva7vvIzlvpfliLDlhYPntKDnmoTkvY3nva4NCgkJCQkJY29uc3QgbGVmdCA9IGUuY2xpZW50WCAtIGRpc1gNCgkJCQkJY29uc3QgdG9wID0gZS5jbGllbnRZIC0gZGlzWQ0KCQkJCQkNCgkJCQkJLy8g57uR5a6a5YWD57Sg5L2N572u5YiwcG9zaXRpb25Y5ZKMcG9zaXRpb25Z5LiK6Z2iDQoJCQkJCXRoaXMucG9zaXRpb25YID0gdG9wDQoJCQkJCXRoaXMucG9zaXRpb25ZID0gbGVmdA0KCQkJCQkNCgkJCQkJLy8g56e75Yqo5b2T5YmN5YWD57SgDQoJCQkJCW9kaXYuc3R5bGUubGVmdCA9IGxlZnQgKyAncHgnDQoJCQkJCW9kaXYuc3R5bGUudG9wID0gdG9wICsgJ3B4Jw0KCQkJfQ0KCQkJZG9jdW1lbnQub25tb3VzZXVwID0gKGUpID0+IHsNCgkJCQkJZG9jdW1lbnQub25tb3VzZW1vdmUgPSBudWxsDQoJCQkJCWRvY3VtZW50Lm9ubW91c2V1cCA9IG51bGwNCgkJCX0NCgkJfSwNCgkJbG9hZFNrZWxldG9uKCkgew0KCQkgIHRoaXMucHJldmlld0xvYWRpbmcgPSB0cnVlDQoJCSAgc2V0VGltZW91dCgoKSA9PiB7DQoJCSAgICB0aGlzLnByZXZpZXdMb2FkaW5nID0gZmFsc2UNCgkJICB9LCA1MDApDQoJCX0sDQoJCWhhbmRsZUp1ZGdlTWVkaWFUeXBlKGF0dGFjaG1lbnQpIHsNCgkJICB2YXIgbWVkaWFUeXBlID0gYXR0YWNobWVudC5tZWRpYVR5cGUNCgkJICAvLyDliKTmlq3mlofku7bnsbvlnosNCgkJICBpZiAobWVkaWFUeXBlKSB7DQoJCSAgICB2YXIgcHJlZml4ID0gbWVkaWFUeXBlLnNwbGl0KCcvJylbMF0NCgkJICAgIGlmIChwcmVmaXggPT09ICd2aWRlbycgfHwgcHJlZml4ID09PSAnZmx2Jykgew0KCQkgICAgICAvLyDmjqfliLblkITkuKrnu4Tku7bnmoTmmL7npLoNCgkJICAgICAgdGhpcy5oYW5kbGVQcmV2aWV3VmlzaWJsZShmYWxzZSwgdHJ1ZSwgZmFsc2UpDQoJCQ0KCQkgICAgICAvLyDljrvpmaTop4bpopHlnLDlnYDlkI7pnaLnmoTlj4LmlbANCgkJICAgICAgdmFyIGxhc3RJbmRleCA9IGF0dGFjaG1lbnQucGF0aC5sYXN0SW5kZXhPZignPycpDQoJCSAgICAgIHZhciBwYXRoID0gYXR0YWNobWVudC5wYXRoLnN1YnN0cmluZygwLCBsYXN0SW5kZXggPT09IC0xID8gYXR0YWNobWVudC5wYXRoLmxlbmdodCA6IGxhc3RJbmRleCkNCgkJICAgICAgLy8g6K6+572u6KeG6aKR5Zyw5Z2ADQoJCSAgICAgIHRoaXMuJHNldCh0aGlzLnZpZGVvT3B0aW9ucy52aWRlbywgJ3VybCcsIHBhdGgpDQoJCSAgICAgIC8qIHRoaXMuJGxvZy5kZWJ1ZygndmlkZW8gdXJsJywgcGF0aCkgKi8NCgkJCQkJY29uc29sZS5sb2coJ3ZpZGVvIHVybDonICsgcGF0aCkNCgkJICAgIH0gZWxzZSBpZiAocHJlZml4ID09PSAnaW1hZ2UnKSB7DQoJCSAgICAgIHRoaXMuaGFuZGxlUHJldmlld1Zpc2libGUodHJ1ZSwgZmFsc2UsIGZhbHNlKQ0KCQkgICAgfSBlbHNlIHsNCgkJICAgICAgdGhpcy5oYW5kbGVQcmV2aWV3VmlzaWJsZShmYWxzZSwgZmFsc2UsIHRydWUpDQoJCSAgICB9DQoJCSAgfQ0KCQl9LA0KCQloYW5kbGVQcmV2aWV3VmlzaWJsZShwaG90bywgdmlkZW8sIG5vbnN1cHBvcnQpIHsNCgkJICAvLyDkuLrkuobmm7Tlpb3nmoTkvb92dWXnm5HlkKzliLDnu4Tku7blj5jljJblj4rml7bliLfmlrAs5pa55byP5L+u5pS557uE5Lu25ZCO6ZyA6KaB5Yi35paw5omN6IO95pi+56S65LiA5LiL6YOo5YiGDQoJCSAgdGhpcy4kc2V0KHRoaXMsICdwaG90b1ByZXZpZXdWaXNpYmxlJywgcGhvdG8pDQoJCSAgdGhpcy4kc2V0KHRoaXMsICd2aWRlb1ByZXZpZXdWaXNpYmxlJywgdmlkZW8pDQoJCSAgdGhpcy4kc2V0KHRoaXMsICdub25zdXBwb3J0UHJldmlld1Zpc2libGUnLCBub25zdXBwb3J0KQ0KCQl9DQoJfQ0KfQ0K"},{"version":3,"sources":["AttachmentPreview.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8CA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"AttachmentPreview.vue","sourceRoot":"src/views/file","sourcesContent":["<template>\r\n\t<div>\r\n\t\t<a-modal\r\n\t\tstyle=\"top: 20px;\"\r\n\t\t  v-model=\"videoPreviewVisible\"\r\n\t\t\t:footer=\"null\"\r\n\t\t\t:maskClosable=\"false\"\r\n\t\t\t:maskStyle=\"{'background-color':'rgba(0, 0, 0, 0)'}\"\r\n\t\t\twrapClassName=\"dplayer-modal\"\r\n\t\t\tdestroyOnClose\r\n\t\t\t:closable=\"false\"\r\n\t\t\tcentered\r\n\t\t>\r\n\t\t\t<div class=\"dplayer-header\" @mousedown=\"move\">\r\n\t\t\t\t<div class=\"dplayer-header-title\">视频播放</div>\r\n\t\t\t\t<div class=\"dplayer-close\" @click=\"videoPreviewVisible = false\">\r\n\t\t\t\t\t<a-icon type=\"close\" />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"dplayer-body\">\r\n\t\t\t\t<d-player\r\n\t\t\t\t  ref=\"player\"\r\n\t\t\t\t  :options=\"videoOptions\"\r\n\t\t\t\t  v-show=\"videoPreviewVisible\"\r\n\t\t\t\t  class=\"video-player-box\"\r\n\t\t\t\t  style=\"width: 100%;\"\r\n\t\t\t\t>\r\n\t\t\t\t</d-player>\r\n\t\t\t</div>\r\n\t\t</a-modal>\r\n\t\t\r\n\t\t<!-- <a-modal\r\n\t\t  title=\"图片预览\"\r\n\t\t  v-model=\"photoPreviewVisible\"\r\n\t\t\t:footer=\"null\"\r\n\t\t\t:maskClosable=\"false\"\r\n\t\t\t:maskStyle=\"{'background-color':'rgba(0, 0, 0, 0)'}\"\r\n\t\t\twrapClassName=\"dplayer-modal\"\r\n\t\t>\r\n\t\t  <img v-show=\"photoPreviewVisible\" :src=\"attachment.path\" style=\"width: 100%;\"/>\r\n\t\t</a-modal> -->\r\n\t\t\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\nimport 'vue-dplayer/dist/vue-dplayer.css'\r\nimport VueDPlayer from 'vue-dplayer'\r\nimport 'viewerjs/dist/viewer.css'\r\nimport Viewer from 'viewerjs'\r\n\r\n\r\nexport default {\r\n\tname: 'AttachmentPreview',\r\n\tcomponents: {\r\n\t\t'd-player': VueDPlayer\r\n\t},\r\n\tprops: {\r\n\t  attachment: {\r\n\t    type: Object,\r\n\t    required: true\r\n\t  },\r\n\t\tvisible: {\r\n\t\t  type: Boolean,\r\n\t\t  required: false,\r\n\t\t  default: true\r\n\t\t}\r\n\t},\r\n\tdata () {\r\n\t\treturn {\r\n\t\t\tphoto: {},\r\n\t\t\tpreviewLoading: true,\r\n\t\t\tphotoPreviewVisible: false,\r\n\t\t\tvideoPreviewVisible: false,\r\n\t\t\tnonsupportPreviewVisible: false,\r\n\t\t\tplayer: {},\r\n\t\t\tvideoOptions: {\r\n\t\t\t  lang: 'zh-cn',\r\n\t\t\t  video: {\r\n\t\t\t    url: '',\r\n\t\t\t    type: 'auto'\r\n\t\t\t  }\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\twatch: {\r\n\t\tvisible: function(newValue, oldValue) {\r\n\t\t  /* this.$log.debug('old value', oldValue)\r\n\t\t  this.$log.debug('new value', newValue) */\r\n\t\t  if (newValue) {\r\n\t\t    this.loadSkeleton()\r\n\t\t  }\r\n\t\t},\r\n\t  attachment: function(newValue, oldValue) {\r\n\t    if (newValue) {\r\n\t      var attachment = newValue\r\n\t      this.handleJudgeMediaType(attachment)\r\n\t    }\r\n\t  },\r\n\t\tphotoPreviewVisible: function(newValue, oldValue) {\r\n\t\t\tthis.showViewer(this, this.photoPreviewVisible)\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tshowViewer(that, photoPreviewVisible) {\r\n\t\t\tif (photoPreviewVisible) {\r\n\t\t\t\tvar image = new Image()\r\n\t\t\t\timage.src = this.attachment.path\r\n\t\t\t\tvar viewer = new Viewer(image, {\r\n\t\t\t\t\thidden() {\r\n\t\t\t\t\t\tviewer.destroy()\r\n\t\t\t\t\t\tthat.photoPreviewVisible = !photoPreviewVisible\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tviewer.show()\r\n\t\t\t}\r\n\t\t},\r\n\t\tmove(e) {\r\n\t\t\t // 获取目标元素\r\n\t\t\tconst odiv = e.target.parentElement.parentElement\r\n\t\t\t// 算出鼠标相对元素的位置\r\n\t\t\tconst disX = e.clientX - odiv.offsetLeft\r\n\t\t\tconst disY = e.clientY - odiv.offsetTop\r\n\t\t\t// 鼠标按下并移动的事件\r\n\t\t\tdocument.onmousemove = (e) => {       \r\n\t\t\t\t\t// 用鼠标的位置减去鼠标相对元素的位置，得到元素的位置\r\n\t\t\t\t\tconst left = e.clientX - disX\r\n\t\t\t\t\tconst top = e.clientY - disY\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 绑定元素位置到positionX和positionY上面\r\n\t\t\t\t\tthis.positionX = top\r\n\t\t\t\t\tthis.positionY = left\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 移动当前元素\r\n\t\t\t\t\todiv.style.left = left + 'px'\r\n\t\t\t\t\todiv.style.top = top + 'px'\r\n\t\t\t}\r\n\t\t\tdocument.onmouseup = (e) => {\r\n\t\t\t\t\tdocument.onmousemove = null\r\n\t\t\t\t\tdocument.onmouseup = null\r\n\t\t\t}\r\n\t\t},\r\n\t\tloadSkeleton() {\r\n\t\t  this.previewLoading = true\r\n\t\t  setTimeout(() => {\r\n\t\t    this.previewLoading = false\r\n\t\t  }, 500)\r\n\t\t},\r\n\t\thandleJudgeMediaType(attachment) {\r\n\t\t  var mediaType = attachment.mediaType\r\n\t\t  // 判断文件类型\r\n\t\t  if (mediaType) {\r\n\t\t    var prefix = mediaType.split('/')[0]\r\n\t\t    if (prefix === 'video' || prefix === 'flv') {\r\n\t\t      // 控制各个组件的显示\r\n\t\t      this.handlePreviewVisible(false, true, false)\r\n\t\t\r\n\t\t      // 去除视频地址后面的参数\r\n\t\t      var lastIndex = attachment.path.lastIndexOf('?')\r\n\t\t      var path = attachment.path.substring(0, lastIndex === -1 ? attachment.path.lenght : lastIndex)\r\n\t\t      // 设置视频地址\r\n\t\t      this.$set(this.videoOptions.video, 'url', path)\r\n\t\t      /* this.$log.debug('video url', path) */\r\n\t\t\t\t\tconsole.log('video url:' + path)\r\n\t\t    } else if (prefix === 'image') {\r\n\t\t      this.handlePreviewVisible(true, false, false)\r\n\t\t    } else {\r\n\t\t      this.handlePreviewVisible(false, false, true)\r\n\t\t    }\r\n\t\t  }\r\n\t\t},\r\n\t\thandlePreviewVisible(photo, video, nonsupport) {\r\n\t\t  // 为了更好的使vue监听到组件变化及时刷新,方式修改组件后需要刷新才能显示一下部分\r\n\t\t  this.$set(this, 'photoPreviewVisible', photo)\r\n\t\t  this.$set(this, 'videoPreviewVisible', video)\r\n\t\t  this.$set(this, 'nonsupportPreviewVisible', nonsupport)\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style>\r\n\t\r\n\t.draggable-wrap {\r\n\t\t/* position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    bottom: 0; */\r\n\t}\t\r\n\t\r\n\t.dplayer-header {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: space-between;\r\n\t\theight: 30px;\r\n\t\tcolor: #808695;\r\n    background-color: #1e1e1e;\r\n\t}\r\n\t\r\n\t.dplayer-header .dplayer-header-title {\r\n\t\tfont-size: 13px;\r\n\t\tpadding-left: 12px;\r\n\t}\r\n\t\r\n\t.dplayer-header .dplayer-close {\r\n\t\tdisplay: inherit;\r\n\t  width: 45px;\r\n\t  height: 100%;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t}\r\n\t\r\n\t.dplayer-header .dplayer-close:hover {\r\n\t\tcolor: #fff;\r\n    background-color: red;\r\n\t}\r\n\t\r\n\t.dplayer-modal .ant-modal-body {\r\n\t\tpadding: 0;\r\n\t\tborder-radius: 3px;\r\n\t}\r\n\t\t\r\n\t\r\n</style>\r\n"]}]}