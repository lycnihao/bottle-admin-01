{"remainingRequest":"F:\\个人git项目\\couldr-user\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\个人git项目\\couldr-user\\src\\views\\system\\Installation.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\个人git项目\\couldr-user\\src\\views\\system\\Installation.vue","mtime":1584854240511},{"path":"F:\\个人git项目\\couldr-user\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\个人git项目\\couldr-user\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"F:\\个人git项目\\couldr-user\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\个人git项目\\couldr-user\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgYWRtaW5BcGkgZnJvbSAnQC9hcGkvYWRtaW4nDQppbXBvcnQgcmVjb3ZlcnlBcGkgZnJvbSAnQC9hcGkvcmVjb3ZlcnknDQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgaW5zdGFsbGF0aW9uOiB7fSwNCiAgICAgIG1pZ3JhdGlvblVwbG9hZE5hbWU6ICdmaWxlJywNCiAgICAgIG1pZ3JhdGlvbkRhdGE6IG51bGwsDQogICAgICBzdGVwQ3VycmVudDogMCwNCiAgICAgIGJsb2dnZXJGb3JtOiB0aGlzLiRmb3JtLmNyZWF0ZUZvcm0odGhpcykNCiAgICB9DQogIH0sDQogIGNyZWF0ZWQoKSB7DQogICAgdGhpcy52ZXJpZnlJc0luc3RhbGwoKQ0KICAgIHRoaXMuaW5zdGFsbGF0aW9uLnVybCA9IHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyB3aW5kb3cubG9jYXRpb24uaG9zdA0KICB9LA0KICBtZXRob2RzOiB7DQogICAgdmVyaWZ5SXNJbnN0YWxsKCkgew0KICAgICAgYWRtaW5BcGkuaXNJbnN0YWxsZWQoKS50aGVuKHJlc3BvbnNlID0+IHsNCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZGF0YSkgew0KICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsgbmFtZTogJ0xvZ2luJyB9KQ0KICAgICAgICB9DQogICAgICB9KQ0KICAgIH0sDQogICAgaGFuZGxlTmV4dFN0ZXAoZSkgew0KICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpDQogICAgICB0aGlzLmJsb2dnZXJGb3JtLnZhbGlkYXRlRmllbGRzKChlcnJvciwgdmFsdWVzKSA9PiB7DQogICAgICAgIC8qIHRoaXMuJGxvZy5kZWJ1ZygnZXJyb3InLCBlcnJvcikNCiAgICAgICAgdGhpcy4kbG9nLmRlYnVnKCdSZWNlaXZlZCB2YWx1ZXMgb2YgZm9ybTogJywgdmFsdWVzKSAqLw0KICAgICAgICBpZiAoZXJyb3IgIT0gbnVsbCkgew0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRoaXMuc3RlcEN1cnJlbnQrKw0KICAgICAgICB9DQogICAgICB9KQ0KICAgIH0sDQogICAgaGFuZGxlTWlncmF0aW9uVXBsb2FkKGRhdGEpIHsNCiAgICAgIHRoaXMuJGxvZy5kZWJ1ZygnU2VsZWN0ZWQgZGF0YScsIGRhdGEpDQogICAgICB0aGlzLm1pZ3JhdGlvbkRhdGEgPSBkYXRhDQogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICB0aGlzLiRsb2cuZGVidWcoJ0hhbmRsZSB1cGxvYWRpbmcnKQ0KICAgICAgICByZXNvbHZlKCkNCiAgICAgIH0pDQogICAgfSwNCiAgICBoYW5kbGVNaWdyYXRpb25GaWxlUmVtb3ZlKGZpbGUpIHsNCiAgICAgIHRoaXMuJGxvZy5kZWJ1ZygnUmVtb3ZlZCBmaWxlJywgZmlsZSkNCiAgICAgIHRoaXMuJGxvZy5kZWJ1ZygnTWlncmF0aW9uIGZpbGUgZnJvbSBkYXRhJywgdGhpcy5taWdyYXRpb25EYXRhLmdldCh0aGlzLm1pZ3JhdGlvblVwbG9hZE5hbWUpKQ0KICAgICAgaWYgKHRoaXMubWlncmF0aW9uRGF0YS5nZXQodGhpcy5taWdyYXRpb25VcGxvYWROYW1lKS51aWQgPT09IGZpbGUudWlkKSB7DQogICAgICAgIHRoaXMubWlncmF0aW9uRGF0YSA9IG51bGwNCiAgICAgICAgdGhpcy5taWdyYXRpb25GaWxlID0gbnVsbA0KICAgICAgfQ0KICAgIH0sDQogICAgaW5zdGFsbCgpIHsNCiAgICAgIGFkbWluQXBpLmluc3RhbGwodGhpcy5pbnN0YWxsYXRpb24pLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICB0aGlzLiRsb2cuZGVidWcoJ0luc3RhbGxhdGlvbiByZXNwb25zZScsIHJlc3BvbnNlKQ0KICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+WuieijheaIkOWKn++8gScpDQogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsgbmFtZTogJ0xvZ2luJyB9KQ0KICAgICAgICB9LCAzMDApDQogICAgICB9KQ0KICAgIH0sDQogICAgaGFuZGxlSW5zdGFsbCgpIHsNCiAgICAgIGNvbnN0IHBhc3N3b3JkID0gdGhpcy5pbnN0YWxsYXRpb24ucGFzc3dvcmQNCiAgICAgIGNvbnN0IGNvbmZpcm1QYXNzd29yZCA9IHRoaXMuaW5zdGFsbGF0aW9uLmNvbmZpcm1QYXNzd29yZA0KDQogICAgICB0aGlzLiRsb2cuZGVidWcoJ1Bhc3N3b3JkJywgcGFzc3dvcmQpDQogICAgICB0aGlzLiRsb2cuZGVidWcoJ0NvbmZpcm0gcGFzc3dvcmQnLCBjb25maXJtUGFzc3dvcmQpDQoNCiAgICAgIGlmIChwYXNzd29yZCAhPT0gY29uZmlybVBhc3N3b3JkKSB7DQogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+ehruiupOWvhueggeWSjOWvhueggeS4jeWMuemFjScpDQogICAgICAgIHJldHVybg0KICAgICAgfQ0KDQogICAgICAvLyBIYW5kbGUgbWlncmF0aW9uDQogICAgICBpZiAodGhpcy5taWdyYXRpb25EYXRhKSB7DQogICAgICAgIHJlY292ZXJ5QXBpLm1pZ3JhdGUodGhpcy5taWdyYXRpb25EYXRhKS50aGVuKHJlc3BvbnNlID0+IHsNCiAgICAgICAgICB0aGlzLiRsb2cuZGVidWcoJ01pZ3JhdGVkIHN1Y2Nlc3NmdWxsbHknKQ0KICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygn5pWw5o2u6L+B56e75oiQ5Yqf77yBJykNCiAgICAgICAgICB0aGlzLmluc3RhbGwoKQ0KICAgICAgICB9KQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5pbnN0YWxsKCkNCiAgICAgIH0NCiAgICB9DQogIH0NCn0NCg=="},{"version":3,"sources":["Installation.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6NA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Installation.vue","sourceRoot":"src/views/system","sourcesContent":["<template>\r\n  <div>\r\n    <a-row\r\n      type=\"flex\"\r\n      justify=\"center\"\r\n      align=\"middle\"\r\n      style=\"height: 100vh;\"\r\n    >\r\n      <a-col\r\n        :xl=\"8\"\r\n        :md=\"12\"\r\n        :sm=\"20\"\r\n        :xs=\"24\"\r\n      >\r\n        <div class=\"card-container\">\r\n          <a-card\r\n            :bordered=\"false\"\r\n            title=\"Couldr 安装向导\"\r\n            style=\"box-shadow: 0px 10px 20px 0px rgba(236, 236, 236, 0.86);\"\r\n          >\r\n\r\n            <a-steps :current=\"stepCurrent\">\r\n              <a-step title=\"博主信息\">\r\n              </a-step>\r\n              <a-step title=\"博客信息\">\r\n              </a-step>\r\n              <a-step title=\"数据迁移\">\r\n              </a-step>\r\n            </a-steps>\r\n            <a-divider dashed />\r\n            <!-- Blogger info -->\r\n            <a-form\r\n              layout=\"horizontal\"\r\n              v-show=\"stepCurrent == 0\"\r\n              :form=\"bloggerForm\"\r\n            >\r\n              <a-form-item class=\"animated fadeInUp\">\r\n                <a-input\r\n                  v-model=\"installation.username\"\r\n                  placeholder=\"用户名\"\r\n                  v-decorator=\"[\r\n                    'username',\r\n                    {rules: [{ required: true, message: '请输入用户名' }]}\r\n                  ]\"\r\n                >\r\n                  <a-icon\r\n                    slot=\"prefix\"\r\n                    type=\"user\"\r\n                    style=\"color: rgba(0,0,0,.25)\"\r\n                  />\r\n                </a-input>\r\n              </a-form-item>\r\n              <a-form-item\r\n                class=\"animated fadeInUp\"\r\n                :style=\"{'animation-delay': '0.1s'}\"\r\n              >\r\n                <a-input\r\n                  v-model=\"installation.nickname\"\r\n                  placeholder=\"用户昵称\"\r\n                >\r\n                  <a-icon\r\n                    slot=\"prefix\"\r\n                    type=\"smile\"\r\n                    style=\"color: rgba(0,0,0,.25)\"\r\n                  />\r\n                </a-input>\r\n              </a-form-item>\r\n              <a-form-item\r\n                class=\"animated fadeInUp\"\r\n                :style=\"{'animation-delay': '0.2s'}\"\r\n              >\r\n                <a-input\r\n                  v-model=\"installation.email\"\r\n                  placeholder=\"用户邮箱\"\r\n                  v-decorator=\"[\r\n                    'email',\r\n                    {rules: [{ required: true, message: '请输入邮箱' }]}\r\n                  ]\"\r\n                >\r\n                  <a-icon\r\n                    slot=\"prefix\"\r\n                    type=\"mail\"\r\n                    style=\"color: rgba(0,0,0,.25)\"\r\n                  />\r\n                </a-input>\r\n              </a-form-item>\r\n              <a-form-item\r\n                class=\"animated fadeInUp\"\r\n                :style=\"{'animation-delay': '0.3s'}\"\r\n              >\r\n                <a-input\r\n                  v-model=\"installation.password\"\r\n                  type=\"password\"\r\n                  placeholder=\"用户密码（8-100位）\"\r\n                  v-decorator=\"[\r\n                    'password',\r\n                    {rules: [{ required: true, message: '请输入密码（8-100位）' }]}\r\n                  ]\"\r\n                >\r\n                  <a-icon\r\n                    slot=\"prefix\"\r\n                    type=\"lock\"\r\n                    style=\"color: rgba(0,0,0,.25)\"\r\n                  />\r\n                </a-input>\r\n              </a-form-item>\r\n              <a-form-item\r\n                class=\"animated fadeInUp\"\r\n                :style=\"{'animation-delay': '0.4s'}\"\r\n              >\r\n                <a-input\r\n                  v-model=\"installation.confirmPassword\"\r\n                  type=\"password\"\r\n                  placeholder=\"确定密码\"\r\n                  v-decorator=\"[\r\n                    'confirmPassword',\r\n                    {rules: [{ required: true, message: '请确定密码' }]}\r\n                  ]\"\r\n                >\r\n                  <a-icon\r\n                    slot=\"prefix\"\r\n                    type=\"lock\"\r\n                    style=\"color: rgba(0,0,0,.25)\"\r\n                  />\r\n                </a-input>\r\n              </a-form-item>\r\n            </a-form>\r\n\r\n            <!-- Blog info -->\r\n\r\n            <a-form\r\n              layout=\"horizontal\"\r\n              v-show=\"stepCurrent == 1\"\r\n            >\r\n              <a-form-item class=\"animated fadeInUp\">\r\n                <a-input\r\n                  v-model=\"installation.url\"\r\n                  placeholder=\"博客地址\"\r\n                >\r\n                  <a-icon\r\n                    slot=\"prefix\"\r\n                    type=\"link\"\r\n                    style=\"color: rgba(0,0,0,.25)\"\r\n                  />\r\n                </a-input>\r\n              </a-form-item>\r\n              <a-form-item\r\n                class=\"animated fadeInUp\"\r\n                :style=\"{'animation-delay': '0.2s'}\"\r\n              >\r\n                <a-input\r\n                  v-model=\"installation.title\"\r\n                  placeholder=\"博客标题\"\r\n                >\r\n                  <a-icon\r\n                    slot=\"prefix\"\r\n                    type=\"book\"\r\n                    style=\"color: rgba(0,0,0,.25)\"\r\n                  />\r\n                </a-input>\r\n              </a-form-item>\r\n            </a-form>\r\n\r\n            <!-- Data migration -->\r\n            <div v-show=\"stepCurrent == 2\">\r\n              <a-alert\r\n                style=\"margin-bottom: 1rem\"\r\n                message=\"如果有迁移需求，请点击并选择'迁移文件'\"\r\n                type=\"info\"\r\n                class=\"animated fadeInUp\"\r\n              />\r\n              <!-- <Upload\r\n                :name=\"migrationUploadName\"\r\n                accept=\"application/json\"\r\n                :uploadHandler=\"handleMigrationUpload\"\r\n                @remove=\"handleMigrationFileRemove\"\r\n                class=\"animated fadeIn\"\r\n                :style=\"{'animation-delay': '0.2s'}\"\r\n              >\r\n                <p class=\"ant-upload-drag-icon\">\r\n                  <a-icon type=\"inbox\" />\r\n                </p>\r\n                <p class=\"ant-upload-text\">点击选择文件或将文件拖拽到此处</p>\r\n                <p class=\"ant-upload-hint\">仅支持单个文件上传</p>\r\n              </Upload> -->\r\n            </div>\r\n\r\n            <a-row\r\n              class=\"install-action\"\r\n              type=\"flex\"\r\n              justify=\"space-between\"\r\n              style=\"margin-top: 1rem;\"\r\n            >\r\n              <div>\r\n                <a-button\r\n                  class=\"previus-button\"\r\n                  v-if=\"stepCurrent != 0\"\r\n                  @click=\"stepCurrent--\"\r\n                  style=\"margin-right: 1rem;\"\r\n                >上一步</a-button>\r\n                <a-button\r\n                  type=\"primary\"\r\n                  v-if=\"stepCurrent != 2\"\r\n                  @click=\"handleNextStep\"\r\n                >下一步</a-button>\r\n              </div>\r\n              <a-button\r\n                v-if=\"stepCurrent == 2\"\r\n                type=\"danger\"\r\n                icon=\"upload\"\r\n                @click=\"handleInstall\"\r\n              >安装</a-button>\r\n            </a-row>\r\n          </a-card>\r\n        </div>\r\n      </a-col>\r\n    </a-row>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport adminApi from '@/api/admin'\r\nimport recoveryApi from '@/api/recovery'\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      installation: {},\r\n      migrationUploadName: 'file',\r\n      migrationData: null,\r\n      stepCurrent: 0,\r\n      bloggerForm: this.$form.createForm(this)\r\n    }\r\n  },\r\n  created() {\r\n    this.verifyIsInstall()\r\n    this.installation.url = window.location.protocol + '//' + window.location.host\r\n  },\r\n  methods: {\r\n    verifyIsInstall() {\r\n      adminApi.isInstalled().then(response => {\r\n        if (response.data.data) {\r\n          this.$router.push({ name: 'Login' })\r\n        }\r\n      })\r\n    },\r\n    handleNextStep(e) {\r\n      e.preventDefault()\r\n      this.bloggerForm.validateFields((error, values) => {\r\n        /* this.$log.debug('error', error)\r\n        this.$log.debug('Received values of form: ', values) */\r\n        if (error != null) {\r\n        } else {\r\n          this.stepCurrent++\r\n        }\r\n      })\r\n    },\r\n    handleMigrationUpload(data) {\r\n      this.$log.debug('Selected data', data)\r\n      this.migrationData = data\r\n      return new Promise((resolve, reject) => {\r\n        this.$log.debug('Handle uploading')\r\n        resolve()\r\n      })\r\n    },\r\n    handleMigrationFileRemove(file) {\r\n      this.$log.debug('Removed file', file)\r\n      this.$log.debug('Migration file from data', this.migrationData.get(this.migrationUploadName))\r\n      if (this.migrationData.get(this.migrationUploadName).uid === file.uid) {\r\n        this.migrationData = null\r\n        this.migrationFile = null\r\n      }\r\n    },\r\n    install() {\r\n      adminApi.install(this.installation).then(response => {\r\n        this.$log.debug('Installation response', response)\r\n        this.$message.success('安装成功！')\r\n        setTimeout(() => {\r\n          this.$router.push({ name: 'Login' })\r\n        }, 300)\r\n      })\r\n    },\r\n    handleInstall() {\r\n      const password = this.installation.password\r\n      const confirmPassword = this.installation.confirmPassword\r\n\r\n      this.$log.debug('Password', password)\r\n      this.$log.debug('Confirm password', confirmPassword)\r\n\r\n      if (password !== confirmPassword) {\r\n        this.$message.error('确认密码和密码不匹配')\r\n        return\r\n      }\r\n\r\n      // Handle migration\r\n      if (this.migrationData) {\r\n        recoveryApi.migrate(this.migrationData).then(response => {\r\n          this.$log.debug('Migrated successfullly')\r\n          this.$message.success('数据迁移成功！')\r\n          this.install()\r\n        })\r\n      } else {\r\n        this.install()\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n"]}]}